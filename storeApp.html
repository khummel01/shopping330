<!DOCTYPE html>
<html>
	<head>
		<title>Class Store App</title>
		<meta charset="utf-8"> 

		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
		<link href="css/styles.css" rel="stylesheet"/>

		<script type="application/javascript" src="js/pubSub.js"></script>
		<script type="application/javascript" src="js/shoppingController.js"></script>
		<script type="application/javascript" src="js/model.js"></script>
	</head>

	<script>
		let pubSub = new Subject();
		let controller = new ShoppingController(pubSub);
// view subscribe to shoppingtable, pass table
		let eventListener = function(scope, msg) {
			let shoppingList = msg;

			// adding HTML to the page
			let myTable = document.getElementById("itemlst");
			// clear table
			let rowCount = myTable.rows.length;
			for (let i = rowCount-1; i > 0; i--) {
				myTable.deleteRow(i);
			}

			let rowNum = 1;
			for (let i = 0; i < shoppingList.getLength(); i++) {			
				let gets = [];
				gets.push(shoppingList.getItems()[i].getItem());
				gets.push(shoppingList.getItems()[i].getSection());
				gets.push(shoppingList.getItems()[i].getQuantity());
				gets.push(shoppingList.getItems()[i].getStore());
				gets.push(shoppingList.getItems()[i].getPriority());
				gets.push(shoppingList.getItems()[i].getPrice());

				let row = myTable.insertRow(rowNum);
				row.id = "row" + rowNum;
				let chkBox = document.createElement("input");
				chkBox.id = "chkBox" + rowNum;
				chkBox.type = "checkbox";
				chkBox.checked = false;
				chkBox.onclick = strikeThrough.bind(chkBox.type, chkBox.id, chkBox.checked, row.id); // ????
				row.appendChild(chkBox);
				for (let j = 0; j < 6; j++) {
					let cell = row.insertCell(j); 
					cell.innerHTML = gets[j];
				}
				rowNum += 1;
			}
			
			document.getElementById("inputForm").reset();
		}

		// register the listener function with Subject
		pubSub.subscribe(eventListener);

		function newItem() {
			let name = document.querySelector("#item").value;
			let section = document.querySelector("#sectiondd").value;
			let quantity = document.querySelector("#quantitydd").value;
			let store = document.querySelector("#storedd").value;
			let priority = document.querySelector("#prioritydd").value;
			let price = document.querySelector("#price").value;
			let spec = {"name": name, "section": section, "quantity": quantity, "store": store, "priority": priority, "price": price};
			controller.newItem(spec);
		}

		// needs to be finished
		function strikeThrough(chkBoxId, checked, rowId, mouseEvent) { // weird occurance here
			if (checked == false) {
				tableRow = document.getElementById(rowId);
				tableRow.style.setProperty("text-decoration", "line-through");
				document.getElementById(chkBoxId).checked = true;
			}
			else {
				tableRow = document.getElementById(rowId);
				tableRow.style.setProperty("text-decoration", "none");
				document.getElementById(chkBoxId).checked = false;
			}
		}
		

	</script>
	
	<body>
		<!-- Navigation -->
		<div class="card text-center">
			<div class="card-header">
			    <ul class="nav nav-pills card-header-pills">
			     	<li class="nav-item">
			        	<a class="nav-link active" href="#">Active</a>
			      	</li>
			      	<li class="nav-item">
			        	<a class="nav-link" href="#">Link</a>
			      	</li>
			      	<li class="nav-item">
			        	<a class="nav-link disabled" href="#">Disabled</a>
			    	</li>
			    </ul>
			  </div>
			<!-- Card body -->
			<div class="card-body">
			<h1 class="card-title">CS330 Shopping App</h1>
			<h3 class="card-text">Let's shop!</h3>
			<a href="#" class="btn btn-primary">Learn More</a>
			</div>
		</div>
		<br><br><br>
		<!-- Form -->
		<form id= "inputForm" class="form-inline">
			<div class="form-row">
				<label for="item">Item</label>
				<input id="item" type=text style="width: 150px" class="form-control">

				<div class="input-group mb-3">
					<label for="section">Section</label>
					<select id="sectiondd" class="custom-select">
						<option></option>
						<option value="baking">Baking</option>
						<option value="beverages">Beverages</option>
						<option value="canned goods">Canned Goods</option>
						<option value="cereal">Cereal/Breakfast</option>
						<option value="condiments">Condiments</option>
						<option value="dairy">Dairy</option>
						<option value="deli">Deli</option>
						<option value="frozen">Frozen</option>
						<option value="meat">Meat</option>
						<option value="misc">Misc</option>
						<option value="non-food">Non-Food Items</option>
						<option value="pasta/rice">Pasta/Rice</option>
						<option value="produce">Produce</option>
						<option value="snacks">Snacks</option>
					</select>
				</div>

				<label for="quantity">Quantity</label>
				<select id="quantitydd">
					<option></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
				</select>
								
				<label for="store">Store</label>
				<select id="storedd">
					<option></option>
					<option value="Co-op">Co-op</option>
					<option value="Fareway">Fareway</option>
					<option value="Walmart">Walmart</option>
					<option value="Culvers">Culvers</option>
				</select>
				
				<label for="priority">Priority</label>
				<select id="prioritydd">
					<option></option>
					<option value="high">High</option>
					<option value="medium">Medium</option>
					<option value="low">Low</option>
				</select>

				<div class="form-group">
					<label for="price">Price</label>
					<input type=text id="price" style="width: 80px" class="form-control"></input>
				</div>
				<button type=button onclick="newItem()" id=gobutt>Add Item</button>
			</div>
		</form>
		<br>
		<table class="table table-striped" id="itemlst">
			<tr>
				<th>Purchased</th>
				<th>Item</th>
				<th>Section</th>
				<th>Quantity</th>
				<th>Store</th>
				<th>Priority</th>
				<th>Price</th>
			</tr>
		</table>

	</body>

</html>